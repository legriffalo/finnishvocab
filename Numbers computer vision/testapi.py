
import json
import psycopg2
import time

def call_db(api_data):
    f = open('apitesting.txt', 'w')
    f.write(f'test at {time.time()} \n')

    conn = psycopg2.connect(database = "tfalrovx", 
        user = "tfalrovx", 
        host= 'rogue.db.elephantsql.com',
        password = "9h9Cz-Nruy-4mBR9AMVTEOoGAQwGGYh1",
        )
    
    f.write('db connection established \n')

    api_data = json.loads(api_data)
    f.write(f'data transformed \n\n {api_data} \n')

    api_query = f"""
    INSERT INTO numbers(contributor,number, URL, time)
    VALUES ('{api_data["contributor"]}', {api_data["number"]}, '{str(api_data["url"])}', {time.time()});
    """
    f.write (f'Query assembled: \n {api_query}')
    try:
        with conn.cursor() as cur:
            cur.execute(api_query)
            f.write('query attempted \n')
            #res = cur.fetchall()

            conn.commit()
            status =  'completed sent to db'
    except:
        status = 'query failed'

    f.write(f'query status is {status}')
    return status



api_data = """{"contributor":"nick","number":"2","url":"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","time":""}
"""

status = call_db(api_data)

print(status)